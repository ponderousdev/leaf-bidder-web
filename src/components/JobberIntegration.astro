---
import Steps from '~/components/widgets/Steps.astro';
---

<Steps
  id="jobber-integration"
  tagline="CRM integration"
  title="Jobber pushes the job. Leaf Bidder returns the price."
  subtitle="Run the pipeline once to see the flow from address to pricing."
  classes={{
    container: 'jobber-pipeline',
    items: {
      container: 'jobber-timeline',
    },
  }}
  items={[
    {
      title: 'Jobber sends the address',
      description:
        'Your CRM pushes a new lead into the pipeline.' +
        '<div class="mt-3 rounded-xl border border-gray-200/60 bg-white/90 px-4 py-3 text-sm text-heading shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#1f1f1f]/80">' +
        '<label class="block text-xs font-semibold uppercase tracking-wide text-muted" for="jobber-address">Property address</label>' +
        '<input id="jobber-address" type="text" class="mt-2 w-full bg-transparent text-base text-heading outline-none" value="8122 Meadowridge Dr, Overland Park, KS" />' +
        '</div>' +
        '<button type="button" class="mt-3 inline-flex w-full items-center justify-center rounded-full border border-gray-400 bg-transparent px-5 py-2 text-sm font-semibold text-page transition hover:bg-gray-100 hover:border-gray-600 dark:border-slate-500 dark:text-slate-300 dark:hover:bg-slate-800" data-jobber-replay>' +
        'Run the pipeline' +
        '</button>',
      icon: 'tabler:plug-connected',
      classes: {
        panel: 'jobber-step jobber-step-1',
        line: 'jobber-line jobber-line-1',
      },
    },
    {
      title: 'We fetch property size',
      description:
        'Leaf Bidder calculates square footage automatically.' +
        '<div class="jobber-loader mt-3 text-xs text-muted" aria-hidden="true">' +
        '<span class="jobber-bar"></span>' +
        '</div>',
      icon: 'tabler:scan',
      classes: {
        panel: 'jobber-step jobber-step-2',
        line: 'jobber-line jobber-line-2',
      },
    },
    {
      title: 'Pricing syncs back to Jobber',
      description:
        'Your price is ready to send.' +
        '<div class="jobber-price mt-3">' +
        '<div class="rounded-xl border border-gray-200/60 bg-white/90 px-4 py-3 text-sm text-heading shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#1f1f1f]/80">' +
        '<span class="block text-xs font-semibold uppercase tracking-wide text-muted">Fixed price</span>' +
        '<span class="jobber-price-text mt-2 block text-lg font-semibold text-heading">$450</span>' +
        '</div>' +
        '</div>',
      icon: 'tabler:calculator',
      classes: {
        panel: 'jobber-step jobber-step-3',
      },
    },
  ]}
/>

<style is:global>
  .jobber-line {
    --jobber-arrow-size: 10px;
    --jobber-arrow-stroke: 3px;
    width: 6px;
    transform: scaleY(0);
    transform-origin: top;
    transition: transform 900ms linear;
    position: relative;
  }

  .jobber-reset .jobber-line {
    transition: none;
    transform: scaleY(0);
  }

  .jobber-line::after {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    width: var(--jobber-arrow-size);
    height: var(--jobber-arrow-size);
    border-right: var(--jobber-arrow-stroke) solid rgba(217, 119, 6, 0.6);
    border-bottom: var(--jobber-arrow-stroke) solid rgba(217, 119, 6, 0.6);
    transform: translateX(-50%) rotate(45deg);
    opacity: 0;
    transition: opacity 300ms ease;
  }

  .jobber-run-1 .jobber-line-1::after,
  .jobber-run-2 .jobber-line-2::after {
    opacity: 1;
  }

  .jobber-timeline [astro-icon] {
    width: 3rem;
    height: 3rem;
  }

  .jobber-run-1 .jobber-line-1 {
    transform: scaleY(1);
  }

  .jobber-run-2 .jobber-line-2 {
    transform: scaleY(1);
  }

  .jobber-price-text {
    opacity: 0;
    transform: translateY(6px);
    transition:
      opacity 300ms ease,
      transform 300ms ease;
  }

  .jobber-run-2 .jobber-price-text {
    opacity: 1;
    transform: translateY(0);
  }

  .jobber-loader {
    max-height: 40px;
    opacity: 1;
  }

  .jobber-bar {
    position: relative;
    display: block;
    height: 20px;
    width: 220px;
    max-width: 100%;
    border-radius: 999px;
    background: rgba(217, 119, 6, 0.12);
    overflow: hidden;
  }

  .jobber-bar::after {
    content: '';
    position: absolute;
    inset: 0;
    transform: translateX(-100%);
    background: linear-gradient(90deg, rgba(217, 119, 6, 0), rgba(217, 119, 6, 0.7), rgba(217, 119, 6, 0));
    animation: none;
  }

  .jobber-loading .jobber-bar::after {
    animation: jobber-bar 1.75s ease-in-out;
    animation-fill-mode: both;
  }

  @keyframes jobber-bar {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }
</style>
